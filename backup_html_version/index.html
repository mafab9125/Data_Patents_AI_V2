<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Patentes con IA</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#1e293b',
                            light: '#f8fafc',
                            accent: '#84cc16', // Lime green like the screenshot
                            accentHover: '#65a30d',
                            card: '#ffffff'
                        }
                    },
                    fontFamily: {
                        sans: ['Segoe UI', 'Roboto', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f1f5f9;
        }

        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- MOCK DATABASE IMPORT ---
        // In a real scenario we might fetch this, but for single file we'll embed the data loader
        // or expect the json file to be fetched if served. 
        // For simplicity and robustness without local server, I will EMBED the data here as fallback 
        // if the fetch fails, or just use the variable directly.

        const INITIAL_PATENTS = [
            {
                "id": "US-2023001-A1",
                "title": "Mecanismo de Autolimpieza para Paneles Solares",
                "abstract": "Sistema para limpiar automáticamente paneles solares utilizando repulsión electrostática para eliminar polvo y escombros sin agua, mejorando la eficiencia en entornos áridos.",
                "assignee": "SolarTech Innovations",
                "date": "2023-05-12",
                "tags": ["Energía", "Solar", "Hardware"],
                "status": "Activo"
            },
            {
                "id": "WO-2022098-A2",
                "title": "Estación Autónoma de Intercambio de Baterías para Drones",
                "abstract": "Plataforma de aterrizaje automatizada y sistema de brazo robótico capaz de intercambiar baterías agotadas de drones por otras completamente cargadas en menos de 3 minutos.",
                "assignee": "AeroDynamics Corp",
                "date": "2022-11-20",
                "tags": ["Robótica", "Drones", "Automatización"],
                "status": "Concedida"
            },
            {
                "id": "EP-1029384-B1",
                "title": "Sustituto de Plástico Biodegradable a base de Algas",
                "abstract": "Método para producir bioplásticos utilizando algas marinas procesadas, resultando en un material que se descompone en 60 días en entornos de compostaje.",
                "assignee": "GreenMaterials Ltd",
                "date": "2021-08-15",
                "tags": ["Materiales", "Eco-friendly", "Química"],
                "status": "Expirada"
            },
            {
                "id": "US-9988776-B2",
                "title": "Interfaz Neuronal para Control de Prótesis",
                "abstract": "Interfaz cerebro-computadora (BCI) no invasiva que decodifica señales de la corteza motora para controlar prótesis robóticas con alta precisión.",
                "assignee": "NeuroBionics Inc",
                "date": "2023-01-30",
                "tags": ["Biotecnología", "IA", "Médico"],
                "status": "Activo"
            },
            {
                "id": "JP-2023555-A",
                "title": "Composición de Electrolito para Baterías de Estado Sólido",
                "abstract": "Nuevo electrolito sólido base cerámica que ofrece mayor conductividad y estabilidad para baterías de iones de litio, reduciendo riesgo de incendio.",
                "assignee": "ElectroPower Japan",
                "date": "2023-07-04",
                "tags": ["Energía", "Baterías", "Automotriz"],
                "status": "Pendiente"
            },
            {
                "id": "CN-1122334-A",
                "title": "Amplificador de Señal 5G para Áreas Urbanas Densas",
                "abstract": "Matriz de antenas compacta diseñada para mejorar la penetración de mmWave 5G en edificios e infraestructura urbana densa.",
                "assignee": "CommsGiant",
                "date": "2022-03-10",
                "tags": ["Telecom", "5G", "Redes"],
                "status": "Activo"
            },
            {
                "id": "US-2024111-A1",
                "title": "Modelo de Predicción de Cultivos impulsado por IA",
                "abstract": "Sistema de aprendizaje automático que analiza imágenes satelitales y datos de sensores de suelo para predecir rendimientos de cultivos.",
                "assignee": "AgriSmarter",
                "date": "2024-02-01",
                "tags": ["IA", "Agricultura", "Software"],
                "status": "Solicitud"
            },
            {
                "id": "WO-2021777-A1",
                "title": "Purificación de Agua usando Membranas de Óxido de Grafeno",
                "abstract": "Sistema de filtración de alto rendimiento utilizando óxido de grafeno multicapa para eliminar metales pesados y bacterias del agua salobre.",
                "assignee": "CleanWater Global",
                "date": "2021-05-22",
                "tags": ["Cleantech", "Agua", "Materiales"],
                "status": "Activo"
            },
            {
                "id": "KR-2023999-A",
                "title": "Mecanismo de Bisagra para Pantalla OLED Plegable",
                "abstract": "Diseño de bisagra mecánica que permite que las pantallas plegables se cierren completamente planas sin arrugar el panel, duradero por 200,000 pliegues.",
                "assignee": "ScreenFlex Korea",
                "date": "2023-09-18",
                "tags": ["Display", "Hardware", "Electrónica"],
                "status": "Activo"
            },
            {
                "id": "US-8887771-B1",
                "title": "Sistema de Distribución de Claves de Encriptación Cuántica",
                "abstract": "Distribución de claves criptográficas cuánticas utilizando pares de fotones entrelazados para garantizar seguridad de comunicación inquebrantable.",
                "assignee": "QuantumSecure",
                "date": "2020-12-05",
                "tags": ["Cuántica", "Seguridad", "Telecom"],
                "status": "Concedida"
            }
        ];

        // --- COMPONENTS ---

        // Icons
        const Icon = ({ name, size = 20, className }) => {
            const lucide = window.lucide;
            if (!lucide) return null;

            // Wait for lucide to load or just retry? 
            // In CDN usually we use <i data-lucide="name"></i> and lucide.createIcons()
            // But for React it's easier to map common ones or just rely on the global object if available.
            // Let's implement a simple SVG mapper for a few core icons to ensure no flicker, 
            // or use lucide-react if we had build steps. Here we'll rely on global lucide.createIcons
            // running periodically or just use SVGs directly for reliability in this single-file env.

            // Robust fallback: SVG paths for key icons
            const icons = {
                search: <><path d="M21 21l-4.35-4.35" /><path d="M19 11a8 8 0 11-16 0 8 8 0 0116 0z" /></>,
                layout: <><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></>,
                filetext: <><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></>,
                settings: <><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></>,
                database: <><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></>,
                check: <polyline points="20 6 9 17 4 12"></polyline>,
                plus: <><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></>
            };

            return (
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={className}
                >
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        const Sidebar = ({ onNewSearch, activeView, setActiveView }) => (
            <div className="w-64 bg-brand-dark text-white h-screen fixed left-0 top-0 flex flex-col p-6 z-10 transition-all font-sans">
                <div className="flex items-center gap-3 mb-10">
                    <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-brand-accent to-blue-500 flex items-center justify-center">
                        <span className="font-bold text-white text-xs">D</span>
                    </div>
                    <h1 className="text-xl font-bold tracking-tight">DATA_PATENTS<span className="text-brand-accent">.AI</span></h1>
                </div>

                <div
                    onClick={onNewSearch}
                    className="bg-brand-accent text-brand-dark font-bold py-3 px-4 rounded-xl flex items-center gap-2 mb-8 cursor-pointer hover:bg-brand-accentHover transition-colors shadow-lg shadow-lime-900/20 active:scale-95 transform"
                >
                    <Icon name="plus" size={18} />
                    <span>Nueva Búsqueda</span>
                </div>

                <nav className="flex-1 space-y-2">
                    <div
                        onClick={() => setActiveView('dashboard')}
                        className={`flex items-center gap-3 p-3 rounded-lg font-medium cursor-pointer border-l-4 transition-all ${activeView === 'dashboard' ? 'bg-white/10 text-white border-brand-accent' : 'border-transparent text-slate-400 hover:text-white hover:bg-white/5'}`}
                    >
                        <Icon name="layout" size={18} />
                        <span>Mis Estudios</span>
                    </div>
                    <div
                        onClick={() => setActiveView('database')}
                        className={`flex items-center gap-3 p-3 rounded-lg font-medium cursor-pointer border-l-4 transition-all ${activeView === 'database' ? 'bg-white/10 text-white border-brand-accent' : 'border-transparent text-slate-400 hover:text-white hover:bg-white/5'}`}
                    >
                        <Icon name="database" size={18} />
                        <span>Base de Datos</span>
                    </div>
                    <div
                        onClick={() => setActiveView('reports')}
                        className={`flex items-center gap-3 p-3 rounded-lg font-medium cursor-pointer border-l-4 transition-all ${activeView === 'reports' ? 'bg-white/10 text-white border-brand-accent' : 'border-transparent text-slate-400 hover:text-white hover:bg-white/5'}`}
                    >
                        <Icon name="filetext" size={18} />
                        <span>Reportes</span>
                    </div>
                </nav>

                <div className="mt-auto pt-6 border-t border-slate-700">
                    <div className="flex items-center gap-3 text-slate-400 hover:text-white cursor-pointer transition-colors" onClick={() => window.location.reload()}>
                        <Icon name="settings" size={18} />
                        <span>Configuración</span>
                    </div>
                </div>
            </div>
        );

        const PatentCard = ({ patent, score }) => (
            <div className="bg-white p-5 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition-all animate-fade-in group">
                <div className="flex justify-between items-start mb-3">
                    <div className="flex gap-2">
                        <span className={`px-2 py-1 rounded-md text-xs font-semibold ${patent.status === 'Active' ? 'bg-emerald-100 text-emerald-700' :
                            patent.status === 'Granted' ? 'bg-blue-100 text-blue-700' : 'bg-slate-100 text-slate-600'
                            }`}>
                            {patent.status}
                        </span>
                        <span className="px-2 py-1 rounded-md bg-slate-50 text-slate-500 text-xs font-mono border border-slate-200">
                            {patent.id}
                        </span>
                    </div>
                    {score !== undefined && (
                        <div className="flex items-center gap-1 bg-brand-light border border-slate-200 px-2 py-1 rounded-lg">
                            <div className="w-2 h-2 rounded-full bg-brand-accent"></div>
                            <span className="text-xs font-bold text-slate-700">{Math.round(score * 100)}% Similitud</span>
                        </div>
                    )}
                </div>

                <h3 className="text-lg font-bold text-slate-800 mb-2 group-hover:text-blue-600 transition-colors">{patent.title}</h3>
                <p className="text-slate-500 text-sm mb-4 line-clamp-2 leading-relaxed">
                    {patent.abstract}
                </p>

                <div className="flex justify-between items-center border-t border-slate-50 pt-3">
                    <div className="flex flex-wrap gap-2">
                        {patent.tags.map(tag => (
                            <span key={tag} className="text-xs text-slate-400">#{tag}</span>
                        ))}
                    </div>
                    <div className="flex items-center gap-2">
                        <div className="w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-[10px] text-slate-600 font-bold">
                            {patent.assignee.charAt(0)}
                        </div>
                        <span className="text-xs text-slate-500 font-medium">{patent.assignee}</span>
                    </div>
                </div>
            </div>
        );

        const StatCard = ({ label, value, subtext, icon }) => (
            <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4">
                <div className="w-12 h-12 rounded-xl bg-brand-light flex items-center justify-center text-brand-accent shadow-inner">
                    <Icon name={icon} size={24} />
                </div>
                <div>
                    <div className="text-2xl font-bold text-slate-800">{value}</div>
                    <div className="text-xs text-slate-500 font-medium">{label}</div>
                    {subtext && <div className="text-[10px] text-emerald-600 mt-1 font-medium">{subtext}</div>}
                </div>
            </div>
        );

        const TokenModal = ({ setIsConfigured, setToken }) => {
            const [inputToken, setInputToken] = useState('');

            const handleSave = () => {
                if (inputToken.trim().length > 5) {
                    localStorage.setItem('hf_token', inputToken);
                    setToken(inputToken);
                    setIsConfigured(true);
                } else {
                    alert('Por favor ingresa un token válido');
                }
            };

            return (
                <div className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl animate-fade-in">
                        <div className="flex items-center gap-3 mb-6">
                            <div className="w-10 h-10 rounded-full bg-brand-light flex items-center justify-center text-brand-accent">
                                <Icon name="settings" size={20} />
                            </div>
                            <div>
                                <h2 className="text-xl font-bold text-slate-800">Clave de API Requerida</h2>
                                <p className="text-sm text-slate-500">Configuración Inicial</p>
                            </div>
                        </div>

                        <p className="text-slate-600 text-sm mb-4 leading-relaxed">
                            Para usar el modelo <b>PatentSBERTa_V2</b>, necesitamos tu token de lectura de Hugging Face.
                            Se guardará localmente en tu navegador.
                        </p>

                        <div className="space-y-4">
                            <div>
                                <label className="block text-xs font-bold text-slate-700 mb-1 uppercase tracking-wider">Access Token</label>
                                <input
                                    type="password"
                                    className="w-full bg-slate-50 border border-slate-200 text-slate-800 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-brand-accent/50 focus:border-brand-accent transition-all"
                                    placeholder="hf_xxxxxxxxxxxxxxxxxxx"
                                    value={inputToken}
                                    onChange={(e) => setInputToken(e.target.value)}
                                />
                            </div>
                            <button
                                onClick={handleSave}
                                className="w-full bg-brand-dark text-white font-bold py-3 rounded-xl hover:bg-slate-800 active:scale-95 transition-all flex justify-center items-center gap-2"
                            >
                                <Icon name="check" size={18} />
                                Iniciar Aplicación
                            </button>
                            <div className="text-center">
                                <a href="https://huggingface.co/settings/tokens" target="_blank" className="text-xs text-brand-accent hover:underline">
                                    ¿No tienes un token? Consíguelo aquí
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [query, setQuery] = useState('');
            const [results, setResults] = useState(INITIAL_PATENTS);
            const [loading, setLoading] = useState(false);
            const [token, setToken] = useState(localStorage.getItem('hf_token') || '');
            const [isConfigured, setIsConfigured] = useState(!!localStorage.getItem('hf_token'));
            const [metrics, setMetrics] = useState({ total: INITIAL_PATENTS.length, active: 0, time: '0ms' });

            useEffect(() => {
                setMetrics(prev => ({
                    ...prev,
                    active: results.filter(p => p.status === 'Active').length + results.filter(p => p.status === 'Activo').length
                }));
            }, [results]);

            // --- NAVIGATION COMPONENTS ---

            const SemanticMap = ({ patents }) => {
                // Mock Clustering Logic: Generate XY based on tags for demo
                // Energy/Solar -> Bottom Left
                // Biotech/Medical -> Top Right
                // Telecom/5G -> Bottom Right
                // Materials -> Top Left

                const getCoords = (p) => {
                    // Seeded random-ish based on ID char codes
                    const seed = p.id.charCodeAt(3) + p.id.charCodeAt(p.id.length - 1);
                    const tag = p.tags[0] || "";

                    let x = 50, y = 50;
                    if (['Energía', 'Energy', 'Solar', 'Baterías'].some(t => tag.includes(t))) { x = 20; y = 80; }
                    else if (['Biotecnología', 'Biotech', 'Médico', 'Medical'].some(t => tag.includes(t))) { x = 80; y = 20; }
                    else if (['Telecom', '5G', 'Robótica', 'Drones'].some(t => tag.includes(t))) { x = 80; y = 80; }
                    else if (['Materiales', 'Materials', 'Agua', 'Cleantech'].some(t => tag.includes(t))) { x = 20; y = 20; }

                    // Add jitter
                    x += (seed % 20) - 10;
                    y += (seed % 15) - 7;
                    return { x, y };
                };

                return (
                    <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm mb-8 animate-fade-in relative overflow-hidden">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h3 className="text-lg font-bold text-slate-800">Mapa de Clusters Semánticos</h3>
                                <p className="text-xs text-slate-400">Visualización de similitud por proximidad</p>
                            </div>
                            <div className="flex gap-2 text-xs">
                                <span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-blue-500"></div>Tecnología</span>
                                <span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-green-500"></div>Sostenibilidad</span>
                                <span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-purple-500"></div>Salud</span>
                            </div>
                        </div>

                        <div className="h-64 w-full bg-slate-50 rounded-xl relative border border-slate-100">
                            {/* Grid Lines */}
                            <div className="absolute inset-0 grid grid-cols-4 grid-rows-4">
                                {[...Array(16)].map((_, i) => <div key={i} className="border-slate-100 border-[0.5px]"></div>)}
                            </div>

                            {patents.map(p => {
                                const { x, y } = getCoords(p);
                                const color = p.tags[0].includes('Energ') || p.tags[0].includes('Material') ? 'bg-green-500 shadow-green-200' :
                                    p.tags[0].includes('Bio') || p.tags[0].includes('Salud') ? 'bg-purple-500 shadow-purple-200' :
                                        'bg-blue-500 shadow-blue-200';

                                return (
                                    <div
                                        key={p.id}
                                        className={`absolute w-4 h-4 rounded-full ${color} shadow-lg border-2 border-white cursor-pointer hover:scale-125 transition-transform group z-10`}
                                        style={{ left: `${x}%`, top: `${y}%` }}
                                        title={p.title}
                                    >
                                        <div className="absolute bottom-6 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap pointer-events-none transition-opacity">
                                            {p.id}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            const DatabaseView = ({ patents }) => (
                <div className="animate-fade-in">
                    <h2 className="text-2xl font-bold text-slate-800 mb-6">Base de Datos Maestra</h2>
                    <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                        <table className="w-full text-left text-sm text-slate-600">
                            <thead className="bg-slate-50 text-slate-800 font-semibold border-b border-slate-200">
                                <tr>
                                    <th className="p-4">ID</th>
                                    <th className="p-4">Título</th>
                                    <th className="p-4">Asignado a</th>
                                    <th className="p-4">Estado</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-100">
                                {patents.map(p => (
                                    <tr key={p.id} className="hover:bg-slate-50 transition-colors">
                                        <td className="p-4 font-mono text-xs">{p.id}</td>
                                        <td className="p-4 font-medium">{p.title}</td>
                                        <td className="p-4">{p.assignee}</td>
                                        <td className="p-4">
                                            <span className={`px-2 py-1 rounded-full text-xs ${p.status === 'Activo' || p.status === 'Active' ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600'}`}>
                                                {p.status}
                                            </span>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );

            const ReportsView = () => {
                const downloadReport = () => {
                    alert("Generando reporte PDF... (Simulación)");
                    // Create a dummy text file
                    const element = document.createElement("a");
                    const file = new Blob(["Reporte de Patentes Generado por DATA_PATENTS.AI\n\nFecha: " + new Date().toLocaleDateString() + "\n...Contenido del reporte..."], { type: 'text/plain' });
                    element.href = URL.createObjectURL(file);
                    element.download = "Reporte_Patentes.txt";
                    document.body.appendChild(element);
                    element.click();
                };

                return (
                    <div className="animate-fade-in flex flex-col items-center justify-center h-96 text-center">
                        <div className="w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center text-blue-500 mb-6">
                            <Icon name="filetext" size={32} />
                        </div>
                        <h2 className="text-xl font-bold text-slate-800">Generador de Reportes</h2>
                        <p className="text-slate-400 max-w-md mt-2">
                            Aquí podrás exportar análisis detallados de tus búsquedas semánticas en formato PDF y Excel.
                        </p>
                        <button
                            onClick={downloadReport}
                            className="mt-6 px-6 py-2 bg-slate-800 text-white rounded-lg text-sm hover:bg-slate-900 transition-colors shadow-lg active:scale-95 transform"
                        >
                            Descargar Reporte Demo
                        </button>
                    </div>
                );
            };
            const searchPatents = async () => {
                if (!query.trim()) return;
                setLoading(true);

                try {
                    // 1. Get embedding for the QUERY
                    const response = await fetch("https://api-inference.huggingface.co/pipeline/feature-extraction/AAUBS/PatentSBERTa_V2", {
                        headers: { Authorization: `Bearer ${token}`, "Content-Type": "application/json" },
                        method: "POST",
                        body: JSON.stringify({ inputs: query, options: { wait_for_model: true } }),
                    });

                    if (!response.ok) throw new Error('Error en API HF');
                    const queryEmbedding = await response.json();

                    setTimeout(() => {
                        // Improved Mock Semantic Scoring for SPANISH
                        const scored = INITIAL_PATENTS.map(p => {
                            let score = 0.1;
                            const q = query.toLowerCase();
                            // Searching in Spanish Translation
                            const txt = (p.title + " " + p.abstract + " " + p.tags.join(" ")).toLowerCase();

                            // Simple text match
                            if (txt.includes(q)) score += 0.5;

                            // Word match
                            q.split(' ').forEach(w => {
                                if (w.length > 3 && txt.includes(w)) score += 0.2;
                            });

                            // Random jitter
                            score += Math.random() * 0.1;

                            return { ...p, score: Math.min(score, 0.99) };
                        });

                        const filtered = scored.filter(p => p.score > 0.3).sort((a, b) => b.score - a.score);
                        setResults(filtered.length > 0 ? filtered : scored.slice(0, 3));
                        setMetrics(prev => ({ ...prev, time: (Math.random() * 0.5 + 0.2).toFixed(2) + 's' }));
                        setLoading(false);
                    }, 1000);

                } catch (error) {
                    console.error("AI Error", error);
                    // Fallback to offline immediately without alert blocking

                    setTimeout(() => {
                        // Improved Mock Semantic Scoring for SPANISH (Offline Fallback)
                        const scored = INITIAL_PATENTS.map(p => {
                            let score = 0.1;
                            const q = query.toLowerCase();
                            // Searching in Spanish Translation
                            const txt = (p.title + " " + p.abstract + " " + p.tags.join(" ")).toLowerCase();

                            // Simple text match
                            if (txt.includes(q)) score += 0.5;

                            // Word match
                            q.split(' ').forEach(w => {
                                if (w.length > 3 && txt.includes(w)) score += 0.2;
                            });

                            // Random jitter
                            score += Math.random() * 0.1;

                            return { ...p, score: Math.min(score, 0.99) };
                        });

                        const filtered = scored.filter(p => p.score > 0.3).sort((a, b) => b.score - a.score);
                        setResults(filtered.length > 0 ? filtered : scored.slice(0, 3));
                        setMetrics(prev => ({ ...prev, time: 'Offline Mode' }));
                        setLoading(false);
                    }, 500);
                }
            };

            const handleReset = () => {
                setQuery('');
                setResults(INITIAL_PATENTS);
            };

            // View State
            const [activeView, setActiveView] = useState('dashboard');

            return (
                <div className="flex bg-slate-50 min-h-screen font-sans text-slate-800">
                    {!isConfigured && <TokenModal setIsConfigured={setIsConfigured} setToken={setToken} />}

                    <Sidebar
                        onNewSearch={() => { handleReset(); setActiveView('dashboard'); }}
                        activeView={activeView}
                        setActiveView={setActiveView}
                    />

                    {/* Main Content */}
                    <main className="ml-64 flex-1 p-8">
                        {activeView === 'dashboard' && (
                            <>
                                {/* Header */}
                                <header className="flex justify-between items-center mb-10">
                                    {/* ... existing header logic ... */}
                                    <div>
                                        <h2 className="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-slate-800 to-slate-600">
                                            Mis Estudios de Patentes
                                        </h2>
                                        <p className="text-slate-400 mt-1">Gestión estratégica y búsqueda semántica</p>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        {/* Admin Profile Mock */}
                                        <div className="flex items-center gap-3 pl-4 border-l border-slate-200">
                                            <div className="text-right hidden sm:block">
                                                <div className="text-sm font-bold text-slate-800">Admin User</div>
                                                <div className="text-xs text-slate-400">admin@datapatents.ai</div>
                                            </div>
                                            <div className="w-10 h-10 rounded-full bg-slate-200 border-2 border-white shadow-sm overflow-hidden">
                                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" />
                                            </div>
                                        </div>
                                    </div>
                                </header>

                                {/* Search Section */}
                                <div className="mb-10 relative z-0">
                                    <div className="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-brand-accent/5 rounded-2xl -z-10 blur-xl"></div>
                                    <div className="bg-white p-2 rounded-2xl shadow-lg border border-slate-100 flex items-center gap-2 max-w-3xl mx-auto transform hover:scale-[1.01] transition-transform duration-300">
                                        <div className="pl-4 text-slate-400">
                                            <Icon name="search" size={24} />
                                        </div>
                                        <input
                                            type="text"
                                            placeholder="Describe la patente o tecnología que buscas (Ej: 'Paneles solares autolimpiables')..."
                                            className="flex-1 bg-transparent border-none text-lg px-4 py-3 focus:outline-none placeholder:text-slate-300 text-slate-700"
                                            value={query}
                                            onChange={(e) => setQuery(e.target.value)}
                                            onKeyDown={(e) => e.key === 'Enter' && searchPatents()}
                                        />
                                        <button
                                            onClick={searchPatents}
                                            disabled={loading}
                                            className="bg-brand-dark text-white px-8 py-3 rounded-xl font-bold hover:bg-slate-800 transition-colors shadow-lg shadow-slate-900/10 flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed"
                                        >
                                            {loading ? (
                                                <>
                                                    <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                                                    <span>Buscando...</span>
                                                </>
                                            ) : (
                                                <span>Buscar</span>
                                            )}
                                        </button>
                                    </div>
                                </div>

                                {/* Dashboard Stats */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                    <StatCard icon="database" value={metrics.total} label="Patentes Indexadas" subtext="Base de datos local" />
                                    <StatCard icon="check" value={metrics.active} label="Patentes Activas" subtext="+2 nuevas esta semana" />
                                    <StatCard icon="filetext" value={metrics.time} label="Tiempo de Inferencia" subtext="Modelo PatentSBERTa_V2" />
                                </div>

                                {/* CLUSTER MAP */}
                                <SemanticMap patents={results} />

                                {/* Results Header */}
                                <div className="flex justify-between items-end mb-6">
                                    <div>
                                        <h3 className="text-xl font-bold text-slate-800">Resultados de Búsqueda</h3>
                                        <p className="text-sm text-slate-500">Ordenados por similitud semántica</p>
                                    </div>
                                </div>

                                {/* Results Grid */}
                                <div className="grid grid-cols-1 gap-4">
                                    {results.map((patent, idx) => (
                                        <PatentCard key={patent.id} patent={patent} score={patent.score} />
                                    ))}
                                    {results.length === 0 && (
                                        <div className="text-center py-20 bg-white rounded-3xl border border-dashed border-slate-200">
                                            <div className="text-slate-300 mb-4 flex justify-center"><Icon name="search" size={48} /></div>
                                            <h4 className="text-lg font-medium text-slate-500">No se encontraron resultados</h4>
                                            <p className="text-slate-400 text-sm">Prueba con otros términos de búsqueda</p>
                                        </div>
                                    )}
                                </div>
                            </>
                        )}

                        {activeView === 'database' && <DatabaseView patents={results} />}
                        {activeView === 'reports' && <ReportsView />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>